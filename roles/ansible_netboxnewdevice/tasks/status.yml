---
- name: "MMN NND - Set available device statuses"
  ansible.builtin.set_fact:
    nnd_device_statuses:
      - { value: 'active', label: 'Active' }
      - { value: 'offline', label: 'Offline' }
      - { value: 'planned', label: 'Planned' }
      - { value: 'staged', label: 'Staged' }
      - { value: 'failed', label: 'Failed' }
      - { value: 'inventory', label: 'Inventory' }
      - { value: 'decommissioning', label: 'Decommissioning' }

- name: "MMN NND - Build table rows for device statuses"
  ansible.builtin.set_fact:
    statuses_table_rows: "{{ statuses_table_rows | default([]) + [row] }}"
  vars:
    index_num: "{{ ansible_loop + 1 }}"
    index_str: "{{ index_num | string }}"
    index_pad: "{{ ('   ' if index_str | length == 1 else ('  ' if index_str | length == 2 else (' ' if index_str | length == 3 else ''))) }}"
    value_str: "{{ item.value }}"
    value_len: "{{ value_str | length }}"
    value_pad: "{{ ('                                        '[:39 - value_len] if value_len < 39 else '') }}"
    row: "{{ index_pad }}{{ index_str }}  | {{ value_str }}{{ value_pad }} | {{ item.label }}"
  loop: "{{ nnd_device_statuses }}"
  loop_control:
    loop_var: item
    index_var: ansible_loop

- name: "MMN NND - Build complete device statuses table message"
  ansible.builtin.set_fact:
    statuses_table_msg: "{{ ['Available Device Statuses:', '====================================================================================', 'Index  | Value                                   | Label', '-------+-----------------------------------------+-----------------------------------'] + statuses_table_rows + ['===================================================================================='] }}"

- name: "MMN NND - Display all available device statuses in table format"
  ansible.builtin.debug:
    msg: "{{ statuses_table_msg }}"

- name: "MMN NND - Prompt for device status index"
  ansible.builtin.pause:
    prompt: |
      Enter the index number of the device status you want to use:
  register: status_index_input
  run_once: true

- name: "MMN NND - Validate device status index input"
  ansible.builtin.assert:
    that:
      - status_index_input.user_input | int > 0
      - status_index_input.user_input | int <= nnd_device_statuses | length
    fail_msg: "Invalid device status index. Please enter a valid index number from the list above."
    success_msg: "Device status index is valid."
  run_once: true

- name: "MMN NND - Set selected device status"
  ansible.builtin.set_fact:
    selected_device_status: "{{ nnd_device_statuses[status_index_input.user_input | int - 1] }}"

- name: "MMN NND - Display selected device status"
  ansible.builtin.debug:
    msg: "Selected device status: {{ selected_device_status.label }} ({{ selected_device_status.value }})"
