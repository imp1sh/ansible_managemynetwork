---
# tasks file for ansible_uhttpd
- name: Detect imagebuilder
  ansible.builtin.set_fact:
    openwrt_uhttpd_deployroot: "{{ openwrt_imagebuilder_deployroot }}"
    openwrt_uhttpd_runimagebuilder: true
  when: openwrt_imagebuilder_deployroot is defined

- name: Make sure deploypath is present
  ansible.builtin.file:
    path: "{{ openwrt_uhttpd_deploypath }}"
    state: directory
    mode: "0755"

- name: Include cert lookup
  ansible.builtin.include_tasks:
    file: cert_lookup.yml
  when: not openwrt_uhttpd_runimagebuilder

- name: Deploy uhttpd config
  ansible.builtin.template:
    src: "uhttpd.jinja2"
    dest: "{{ openwrt_uhttpd_deploypath }}/{{ openwrt_uhttpd_deployfile }}"
    mode: "0644"
  notify: Restart uhttpd
